
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Protein example &#8212; mayavi 4.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Flight graph example" href="example_flight_graph.html" />
    <link rel="prev" title="Mri example" href="example_mri.html" />
<style type="text/css">
  body {
    /* Very bottom copyright, etc. info */
    background: #4d598d;
  }

  .documentwrapper {
    /* Blank area on left bar */
    background: #24326e;
  }

  .related {
    /* Long horizontal nav bars */
    background: #3c4b8a!important;
  }

  .sphinxsidebarwrapper {
    /* Filled part of left sidebar */
    background: #24326e;
  }

  a {
    color: #253370;
  }

  .sphinxsidebarwrapper a {
    color: #f2f2f2!important;
  }
</style>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example_flight_graph.html" title="Flight graph example"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="example_mri.html" title="Mri example"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mayavi 4.8.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="examples.html" accesskey="U">Example gallery</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Protein example</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="protein-example">
<span id="example-protein"></span><h1>Protein example<a class="headerlink" href="#protein-example" title="Permalink to this heading">Â¶</a></h1>
<p>Visualize a protein graph structure downloaded from the protein database in
standard pdb format.</p>
<p>We parse the pdb file, but extract only a very small amount of
information: the type of atoms, their positions, and the links between them.</p>
<p>Most of the complexity of this example comes from the code turning the
PDB information into a list of 3D positions, with associated scalar
and connection information.</p>
<p>We assign a scalar value for the atoms to differenciate the different
types of atoms, but it does not correspond to the atomic mass. The size
and the color of the atom on the visualization is therefore not
chemicaly-significant.</p>
<p>The atoms are plotted using mlab.points3d, and connections between atoms
are added to the dataset, and visualized using a surface module.</p>
<p>The graph is created by adding connection information to points. For this, each
point is designated by its number (in the order of the array passed to
mlab.points3d), and the connection array, made of pairs of these numbers, is
constructed. There is some slightly tedious data manipulation to go from the
named-node graph representation as stored in the pdb file, to the index-based
connection pairs. A similar technique to plot the graph is done in the
<a class="reference internal" href="example_flight_graph.html#example-flight-graph"><span class="std std-ref">Flight graph example</span></a>. Another example of graph plotting, showing a
different technique to plot the graph, can be seen on
<a class="reference internal" href="example_delaunay_graph.html#example-delaunay-graph"><span class="std std-ref">Delaunay graph example</span></a>.</p>
<p>To visualize the local atomic density, we use a gaussian splatter filter
that builds a kernel density estimation of the continuous density field:
each point is convoluted by a Gaussian kernel, and the sum of these
Gaussians form the resulting density field. We visualize this field using
volume rendering.</p>
<p>Reference for the pdb file standard:
<a class="reference external" href="http://mmcif.pdb.org/dictionaries/pdb-correspondence/pdb2mmcif.html">http://mmcif.pdb.org/dictionaries/pdb-correspondence/pdb2mmcif.html</a></p>
<img alt="../_images/example_protein.jpg" class="align-center" src="../_images/example_protein.jpg" />
<p><strong>Python source code:</strong> <a class="reference download internal" download="" href="../_downloads/2ae8f037976c6839ebeac2dd5e5728d5/protein.py"><code class="xref download docutils literal notranslate"><span class="pre">protein.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Author: Gael Varoquaux &lt;gael.varoquaux@normalesup.org&gt;</span>
<span class="c1"># Copyright (c) 2008-2020, Enthought, Inc.</span>
<span class="c1"># License: BSD Style.</span>

<span class="c1"># The pdb code for the protein.</span>
<span class="n">protein_code</span> <span class="o">=</span> <span class="s1">&#39;2q09&#39;</span>

<span class="c1"># Retrieve the file from the protein database #################################</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;pdb</span><span class="si">%s</span><span class="s1">.ent.gz&#39;</span> <span class="o">%</span> <span class="n">protein_code</span><span class="p">):</span>
    <span class="c1"># Download the data</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlopen</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Downloading protein data, please wait&#39;</span><span class="p">)</span>
    <span class="n">opener</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span>
      <span class="s1">&#39;ftp://ftp.wwpdb.org/pub/pdb/data/structures/divided/pdb/q0/pdb</span><span class="si">%s</span><span class="s1">.ent.gz&#39;</span>
      <span class="o">%</span> <span class="n">protein_code</span><span class="p">)</span>
    <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;pdb</span><span class="si">%s</span><span class="s1">.ent.gz&#39;</span> <span class="o">%</span> <span class="n">protein_code</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">opener</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c1"># Parse the pdb file ##########################################################</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="n">infile</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="s1">&#39;pdb</span><span class="si">%s</span><span class="s1">.ent.gz&#39;</span> <span class="o">%</span> <span class="n">protein_code</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>

<span class="c1"># A graph represented by a dictionary associating nodes with keys</span>
<span class="c1"># (numbers), and edges (pairs of node keys).</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">atoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="c1"># Build the graph from the PDB information</span>
<span class="n">last_atom_label</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">last_chain_label</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ATOM&#39;</span><span class="p">,</span> <span class="s1">&#39;HETATM&#39;</span><span class="p">):</span>
        <span class="n">nodes</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">chain_label</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">chain_label</span> <span class="o">==</span> <span class="n">last_chain_label</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">last_atom_label</span><span class="p">))</span>
        <span class="n">last_atom_label</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">last_chain_label</span> <span class="o">=</span> <span class="n">chain_label</span>
    <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CONECT&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">atoms</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">atoms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">))))</span>

<span class="c1"># Turn the graph into 3D positions, and a connection list.</span>
<span class="n">labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">z</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">scalars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
    <span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    <span class="n">this_scalar</span><span class="p">,</span> <span class="n">this_x</span><span class="p">,</span> <span class="n">this_y</span><span class="p">,</span> <span class="n">this_z</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
    <span class="n">scalars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">this_scalar</span><span class="p">])</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">this_x</span><span class="p">))</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">this_y</span><span class="p">))</span>
    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">this_z</span><span class="p">))</span>

<span class="n">connections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
    <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">stop</span><span class="p">]))</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">scalars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scalars</span><span class="p">)</span>

<span class="c1"># Visualize the data ##########################################################</span>
<span class="kn">from</span> <span class="nn">mayavi</span> <span class="kn">import</span> <span class="n">mlab</span>
<span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">mlab</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">pts</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">scalars</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">scalars</span><span class="p">,</span>
                                    <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">pts</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connections</span><span class="p">)</span>

<span class="c1"># Use a tube fiter to plot tubes on the link, varying the radius with the</span>
<span class="c1"># scalar value</span>
<span class="n">tube</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">tube</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">tube_radius</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">tube</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">radius_factor</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">tube</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">vary_radius</span> <span class="o">=</span> <span class="s1">&#39;vary_radius_by_scalar&#39;</span>
<span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">tube</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Visualize the local atomic density</span>
<span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">volume</span><span class="p">(</span><span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">gaussian_splatter</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span>

<span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mf">31.5</span><span class="p">,</span> <span class="mf">52.8</span><span class="p">,</span> <span class="p">(</span><span class="mf">4.2</span><span class="p">,</span> <span class="mf">37.3</span><span class="p">,</span> <span class="mf">20.6</span><span class="p">))</span>

<span class="n">mlab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mayavi-logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="example_mri.html"
                          title="previous chapter">Mri example</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="example_flight_graph.html"
                          title="next chapter">Flight graph example</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/auto/example_protein.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example_flight_graph.html" title="Flight graph example"
             >next</a> |</li>
        <li class="right" >
          <a href="example_mri.html" title="Mri example"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mayavi 4.8.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="examples.html" >Example gallery</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Protein example</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2018, Enthought Inc..
      Last updated on Jul 11, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>