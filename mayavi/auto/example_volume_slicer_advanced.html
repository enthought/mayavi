
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Volume slicer advanced example &#8212; mayavi 4.8.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Polydata example" href="example_polydata.html" />
    <link rel="prev" title="Coil design application example" href="example_coil_design_application.html" />
<style type="text/css">
  body {
    /* Very bottom copyright, etc. info */
    background: #4d598d;
  }

  .documentwrapper {
    /* Blank area on left bar */
    background: #24326e;
  }

  .related {
    /* Long horizontal nav bars */
    background: #3c4b8a!important;
  }

  .sphinxsidebarwrapper {
    /* Filled part of left sidebar */
    background: #24326e;
  }

  a {
    color: #253370;
  }

  .sphinxsidebarwrapper a {
    color: #f2f2f2!important;
  }
</style>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example_polydata.html" title="Polydata example"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="example_coil_design_application.html" title="Coil design application example"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mayavi 4.8.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="examples.html" accesskey="U">Example gallery</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Volume slicer advanced example</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="volume-slicer-advanced-example">
<span id="example-volume-slicer-advanced"></span><h1>Volume slicer advanced example<a class="headerlink" href="#volume-slicer-advanced-example" title="Permalink to this heading">¶</a></h1>
<p>An efficient implementation of the triple-plane view showing 3 cut planes
on volumetric data, and side views showing each cut, with a cursor to
move the other cuts.</p>
<p>This is an example of complex callback interaction. It builds on the
<a class="reference internal" href="example_volume_slicer.html#example-volume-slicer"><span class="std std-ref">Volume slicer example</span></a> but has more complex logic. You should try
to understand the <a class="reference internal" href="example_volume_slicer.html#example-volume-slicer"><span class="std std-ref">Volume slicer example</span></a> first.</p>
<p>In this example, the VolumeSlicer object displays a position attribute
giving the position of the cut in data coordinates. Traits callbacks are
used to move the cut planes when this position attribute is modifed.</p>
<p>In the 3D window, the 3D cuts are displayed using ImagePlaneWidgets
cutting the 3D volumetric data. The data extracted by the
ImagePlaneWidgets for plotting is captured using the TVTK
ImagePlaneWidget’s <cite>_get_reslice_output</cite> method. The resulting dataset is
plotted in each side view using another ImagePlaneWidget. As a result the
data is not copied (at the VTK level, there is only one pipeline), and
modifications of the data plotted on the planes in the 3D view (for
instance when these planes are moved) are propagated to the 2D side views
by the VTK pipeline.</p>
<p>A cursor is displayed in each side view using a glyph. The cursor
indicates the position of the cut.</p>
<p>In the side view, when the mouse button is pressed on the planes, it
creates a VTK <cite>InteractionEvent</cite>. When this happens, VTK calls an
callback (observer, it VTK terms), that we use to move the position of
the cut. The Traits callbacks do the rest for the updating.</p>
<p><strong>Python source code:</strong> <a class="reference download internal" download="" href="../_downloads/ba9dfd2c0ac7e6dfe7d5ecb6a3a76d4f/volume_slicer_advanced.py"><code class="xref download docutils literal notranslate"><span class="pre">volume_slicer_advanced.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> \
    <span class="n">Bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">on_trait_change</span>
<span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">View</span><span class="p">,</span> <span class="n">Item</span><span class="p">,</span> <span class="n">HGroup</span><span class="p">,</span> <span class="n">Group</span>

<span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="kn">from</span> <span class="nn">tvtk.pyface.scene</span> <span class="kn">import</span> <span class="n">Scene</span>

<span class="kn">from</span> <span class="nn">mayavi</span> <span class="kn">import</span> <span class="n">mlab</span>
<span class="kn">from</span> <span class="nn">mayavi.core.api</span> <span class="kn">import</span> <span class="n">PipelineBase</span><span class="p">,</span> <span class="n">Source</span>
<span class="kn">from</span> <span class="nn">mayavi.core.ui.api</span> <span class="kn">import</span> <span class="n">SceneEditor</span><span class="p">,</span> <span class="n">MlabSceneModel</span>


<span class="c1">################################################################################</span>
<span class="c1"># The object implementing the dialog</span>
<span class="k">class</span> <span class="nc">VolumeSlicer</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="c1"># The data to plot</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Array</span>

    <span class="c1"># The position of the view</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>

    <span class="c1"># The 4 views displayed</span>
    <span class="n">scene3d</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">MlabSceneModel</span><span class="p">,</span> <span class="p">())</span>
    <span class="n">scene_x</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">MlabSceneModel</span><span class="p">,</span> <span class="p">())</span>
    <span class="n">scene_y</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">MlabSceneModel</span><span class="p">,</span> <span class="p">())</span>
    <span class="n">scene_z</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">MlabSceneModel</span><span class="p">,</span> <span class="p">())</span>

    <span class="c1"># The data source</span>
    <span class="n">data_src</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Source</span><span class="p">)</span>

    <span class="c1"># The image plane widgets of the 3D scene</span>
    <span class="n">ipw_3d_x</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">PipelineBase</span><span class="p">)</span>
    <span class="n">ipw_3d_y</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">PipelineBase</span><span class="p">)</span>
    <span class="n">ipw_3d_z</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">PipelineBase</span><span class="p">)</span>

    <span class="c1"># The cursors on each view:</span>
    <span class="n">cursors</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>

    <span class="n">disable_render</span> <span class="o">=</span> <span class="n">Bool</span>

    <span class="n">_axis_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="c1"># Object interface</span>
    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VolumeSlicer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">traits</span><span class="p">)</span>
        <span class="c1"># Force the creation of the image_plane_widgets:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipw_3d_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipw_3d_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipw_3d_z</span>


    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="c1"># Default values</span>
    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_position_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_data_src_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_field</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                            <span class="n">figure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene3d</span><span class="o">.</span><span class="n">mayavi_scene</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">make_ipw_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_name</span><span class="p">):</span>
        <span class="n">ipw</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_src</span><span class="p">,</span>
                        <span class="n">figure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene3d</span><span class="o">.</span><span class="n">mayavi_scene</span><span class="p">,</span>
                        <span class="n">plane_orientation</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_axes&#39;</span> <span class="o">%</span> <span class="n">axis_name</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cut </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">axis_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ipw</span>

    <span class="k">def</span> <span class="nf">_ipw_3d_x_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_ipw_3d</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ipw_3d_y_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_ipw_3d</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ipw_3d_z_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_ipw_3d</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>


    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="c1"># Scene activation callbacks</span>
    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="nd">@on_trait_change</span><span class="p">(</span><span class="s1">&#39;scene3d.activated&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">display_scene3d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outline</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">outline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_src</span><span class="p">,</span>
                        <span class="n">figure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene3d</span><span class="o">.</span><span class="n">mayavi_scene</span><span class="p">,</span>
                        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene3d</span><span class="o">.</span><span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="c1"># Interaction properties can only be changed after the scene</span>
        <span class="c1"># has been created, and thus the interactor exists</span>
        <span class="k">for</span> <span class="n">ipw</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ipw_3d_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ipw_3d_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ipw_3d_z</span><span class="p">):</span>
            <span class="n">ipw</span><span class="o">.</span><span class="n">ipw</span><span class="o">.</span><span class="n">interaction</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Keep the view always pointing up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene3d</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">interactor_style</span> <span class="o">=</span> \
                                 <span class="n">tvtk</span><span class="o">.</span><span class="n">InteractorStyleTerrain</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_position</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">make_side_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_name</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;scene_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">axis_name</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">parallel_projection</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ipw_3d</span>   <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ipw_3d_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">axis_name</span><span class="p">)</span>

        <span class="c1"># We create the image_plane_widgets in the side view using a</span>
        <span class="c1"># VTK dataset pointing to the data on the corresponding</span>
        <span class="c1"># image_plane_widget in the 3D view (it is returned by</span>
        <span class="c1"># ipw_3d._get_reslice_output())</span>
        <span class="n">side_src</span> <span class="o">=</span> <span class="n">ipw_3d</span><span class="o">.</span><span class="n">ipw</span><span class="o">.</span><span class="n">_get_reslice_output</span><span class="p">()</span>
        <span class="n">ipw</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="p">(</span>
                            <span class="n">side_src</span><span class="p">,</span>
                            <span class="n">plane_orientation</span><span class="o">=</span><span class="s1">&#39;z_axes&#39;</span><span class="p">,</span>
                            <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                            <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                            <span class="n">figure</span><span class="o">=</span><span class="n">scene</span><span class="o">.</span><span class="n">mayavi_scene</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cut view </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">axis_name</span><span class="p">,</span>
                            <span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ipw_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">axis_name</span><span class="p">,</span> <span class="n">ipw</span><span class="p">)</span>

        <span class="c1"># Extract the spacing of the side_src to convert coordinates</span>
        <span class="c1"># into indices</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="n">side_src</span><span class="o">.</span><span class="n">spacing</span>

        <span class="c1"># Make left-clicking create a crosshair</span>
        <span class="n">ipw</span><span class="o">.</span><span class="n">ipw</span><span class="o">.</span><span class="n">left_button_action</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="n">scale_factor</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                            <span class="n">figure</span><span class="o">=</span><span class="n">scene</span><span class="o">.</span><span class="n">mayavi_scene</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cursor view </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">axis_name</span><span class="p">,</span>
                        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">axis_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursor</span>

        <span class="c1"># Add a callback on the image plane widget interaction to</span>
        <span class="c1"># move the others</span>
        <span class="n">this_axis_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="p">[</span><span class="n">axis_name</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">move_view</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
            <span class="c1"># Disable rendering on all scene</span>
            <span class="n">position</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">GetCurrentCursorPosition</span><span class="p">()</span><span class="o">*</span><span class="n">spacing</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">position</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">this_axis_number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">this_axis_number</span><span class="p">])</span>
            <span class="c1"># We need to special case y, as the view has been rotated.</span>
            <span class="k">if</span> <span class="n">axis_name</span> <span class="ow">is</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>

        <span class="n">ipw</span><span class="o">.</span><span class="n">ipw</span><span class="o">.</span><span class="n">add_observer</span><span class="p">(</span><span class="s1">&#39;InteractionEvent&#39;</span><span class="p">,</span> <span class="n">move_view</span><span class="p">)</span>
        <span class="n">ipw</span><span class="o">.</span><span class="n">ipw</span><span class="o">.</span><span class="n">add_observer</span><span class="p">(</span><span class="s1">&#39;StartInteractionEvent&#39;</span><span class="p">,</span> <span class="n">move_view</span><span class="p">)</span>

        <span class="c1"># Center the image plane widget</span>
        <span class="n">ipw</span><span class="o">.</span><span class="n">ipw</span><span class="o">.</span><span class="n">slice_position</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="p">[</span><span class="n">axis_name</span><span class="p">]]</span>

        <span class="c1"># 2D interaction: only pan and zoom</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">interactor</span><span class="o">.</span><span class="n">interactor_style</span> <span class="o">=</span> \
                                 <span class="n">tvtk</span><span class="o">.</span><span class="n">InteractorStyleImage</span><span class="p">()</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Some text:</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">axis_name</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>

        <span class="c1"># Choose a view that makes sens</span>
        <span class="n">views</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">views</span><span class="p">[</span><span class="n">axis_name</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">views</span><span class="p">[</span><span class="n">axis_name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">focalpoint</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                  <span class="n">figure</span><span class="o">=</span><span class="n">scene</span><span class="o">.</span><span class="n">mayavi_scene</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">parallel_scale</span> <span class="o">=</span> <span class="mf">0.52</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="nd">@on_trait_change</span><span class="p">(</span><span class="s1">&#39;scene_x.activated&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">display_scene_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_side_view</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

    <span class="nd">@on_trait_change</span><span class="p">(</span><span class="s1">&#39;scene_y.activated&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">display_scene_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_side_view</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

    <span class="nd">@on_trait_change</span><span class="p">(</span><span class="s1">&#39;scene_z.activated&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">display_scene_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_side_view</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>


    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="c1"># Traits callback</span>
    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="nd">@on_trait_change</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update the position of the cursors on each side view, as well</span>
<span class="sd">            as the image_plane_widgets in the 3D view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First disable rendering in all scenes to avoid unnecessary</span>
        <span class="c1"># renderings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_render</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># For each axis, move image_plane_widget and the cursor in the</span>
        <span class="c1"># side view</span>
        <span class="k">for</span> <span class="n">axis_name</span><span class="p">,</span> <span class="n">axis_number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ipw3d</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ipw_3d_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">axis_name</span><span class="p">)</span>
            <span class="n">ipw3d</span><span class="o">.</span><span class="n">ipw</span><span class="o">.</span><span class="n">slice_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">axis_number</span><span class="p">]</span>

            <span class="c1"># Go from the 3D position, to the 2D coordinates in the</span>
            <span class="c1"># side view</span>
            <span class="n">position2d</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
            <span class="n">position2d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">axis_number</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">axis_name</span> <span class="ow">is</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">position2d</span> <span class="o">=</span> <span class="n">position2d</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Move the cursor</span>
            <span class="c1"># For the following to work, you need Mayavi 3.4.0, if you</span>
            <span class="c1"># have a less recent version, use &#39;x=[position2d[0]]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursors</span><span class="p">[</span><span class="n">axis_name</span><span class="p">]</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">trait_set</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">position2d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">position2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Finally re-enable rendering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_render</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@on_trait_change</span><span class="p">(</span><span class="s1">&#39;disable_render&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_render_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">scene</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene3d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene_y</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">scene_z</span><span class="p">):</span>
            <span class="n">scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">disable_render</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_render</span>


    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="c1"># The layout of the dialog created</span>
    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="n">HGroup</span><span class="p">(</span>
                  <span class="n">Group</span><span class="p">(</span>
                       <span class="n">Item</span><span class="p">(</span><span class="s1">&#39;scene_y&#39;</span><span class="p">,</span>
                            <span class="n">editor</span><span class="o">=</span><span class="n">SceneEditor</span><span class="p">(</span><span class="n">scene_class</span><span class="o">=</span><span class="n">Scene</span><span class="p">),</span>
                            <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">),</span>
                       <span class="n">Item</span><span class="p">(</span><span class="s1">&#39;scene_z&#39;</span><span class="p">,</span>
                            <span class="n">editor</span><span class="o">=</span><span class="n">SceneEditor</span><span class="p">(</span><span class="n">scene_class</span><span class="o">=</span><span class="n">Scene</span><span class="p">),</span>
                            <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">),</span>
                       <span class="n">show_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="p">),</span>
                  <span class="n">Group</span><span class="p">(</span>
                       <span class="n">Item</span><span class="p">(</span><span class="s1">&#39;scene_x&#39;</span><span class="p">,</span>
                            <span class="n">editor</span><span class="o">=</span><span class="n">SceneEditor</span><span class="p">(</span><span class="n">scene_class</span><span class="o">=</span><span class="n">Scene</span><span class="p">),</span>
                            <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">),</span>
                       <span class="n">Item</span><span class="p">(</span><span class="s1">&#39;scene3d&#39;</span><span class="p">,</span>
                            <span class="n">editor</span><span class="o">=</span><span class="n">SceneEditor</span><span class="p">(</span><span class="n">scene_class</span><span class="o">=</span><span class="n">Scene</span><span class="p">),</span>
                            <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">),</span>
                       <span class="n">show_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">resizable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Volume Slicer&#39;</span><span class="p">,</span>
                <span class="p">)</span>


<span class="c1">################################################################################</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Create some data</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">VolumeSlicer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">configure_traits</span><span class="p">()</span>
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mayavi-logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="example_coil_design_application.html"
                          title="previous chapter">Coil design application example</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="example_polydata.html"
                          title="next chapter">Polydata example</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/auto/example_volume_slicer_advanced.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example_polydata.html" title="Polydata example"
             >next</a> |</li>
        <li class="right" >
          <a href="example_coil_design_application.html" title="Coil design application example"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mayavi 4.8.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="examples.html" >Example gallery</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Volume slicer advanced example</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2018, Enthought Inc..
      Last updated on Oct 18, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>